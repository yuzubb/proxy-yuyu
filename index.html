<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yuzupp | Webãƒ—ãƒ­ã‚­ã‚·</title>
    <style>
        :root {
            /* ã‚°ãƒ¬ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆç°è‰²ï¼‰ã‚’åŸºèª¿ã¨ã—ãŸãƒ‡ã‚¶ã‚¤ãƒ³ */
            --primary-color: #374151; /* æ¿ƒã„ç°è‰²ï¼ˆãƒ¡ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚«ãƒ©ãƒ¼ï¼‰ */
            --primary-hover-color: #1f2937; /* ã•ã‚‰ã«æ¿ƒã„ç°è‰² */
            --text-color: #1f2937;
            --bg-color: #f3f4f6; /* è–„ã„ç°è‰²ï¼ˆèƒŒæ™¯ï¼‰ */
            --header-bg: #4b5563; /* ãƒ˜ãƒƒãƒ€ãƒ¼èƒŒæ™¯ */
            --border-color: #9ca3af;
            --input-focus-color: #374151;
            --header-height: 60px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            height: var(--header-height);
            background-color: var(--header-bg);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 20;
            flex-shrink: 0;
            gap: 15px; /* è¦ç´ é–“ã®éš™é–“ã‚’èª¿æ•´ */
        }

        /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #back-button {
            /* ç›®ç«‹ãŸãªã„ç°è‰² */
            background-color: #6b7280; 
            color: white;
            border: none;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            line-height: 1;
            display: none; /* åˆæœŸã¯éè¡¨ç¤º */
        }
        #back-button:hover {
            background-color: #4b5563;
        }

        h1 {
            font-size: 1.25rem;
            font-weight: 800;
            color: white;
            margin-right: 20px;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .form-group {
            display: flex;
            gap: 10px;
            flex-grow: 1;
            align-items: center;
        }

        #url-input {
            flex-grow: 1;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            outline: none;
            min-width: 150px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        #url-input:focus {
            border-color: var(--input-focus-color);
            box-shadow: 0 0 0 3px rgba(55, 65, 81, 0.2);
        }

        #load-button {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            white-space: nowrap;
        }
        #load-button:hover {
            background-color: var(--primary-hover-color);
        }
        #load-button:active {
            transform: translateY(1px);
        }

        .content-container {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
        }

        #proxy-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
            background-color: white;
        }

        .message-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.1rem;
            color: #4b5563;
            z-index: 10;
        }

        .loading-message { 
            color: var(--primary-color); 
            font-weight: 600; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-size: 1rem;
        }

        .spinner {
            border: 4px solid rgba(55, 65, 81, 0.2);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ: ç‹­ã„ç”»é¢ã§ã¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ */
        @media (max-width: 600px) {
            .header {
                flex-direction: column;
                height: auto;
                padding: 10px 15px;
                gap: 5px;
            }
            #back-button {
                /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å°‘ã—ç›®ç«‹ã¤ã‚ˆã†ã«ã™ã‚‹ */
                padding: 8px 10px;
            }
            h1 {
                margin: 0;
                width: 100%;
                text-align: center;
            }
            .title-group {
                display: flex;
                width: 100%;
                justify-content: space-between;
                align-items: center;
            }
            .form-group {
                width: 100%;
                gap: 8px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <button id="back-button" title="å‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹">â† æˆ»ã‚‹</button>
        <h1>yuzupp</h1>
        <div class="form-group">
            <input type="url" id="url-input" 
                   placeholder="è¡¨ç¤ºã—ãŸã„å¤–éƒ¨URLã‚’å…¥åŠ› (ä¾‹: https://example.com)" 
                   value="">
            <button id="load-button">
                èª­ã¿è¾¼ã‚€
            </button>
        </div>
    </div>

    <div id="content-container" class="content-container">
        <div id="initial-message" class="message-overlay">
            è¡¨ç¤ºã—ãŸã„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®URLã‚’å…¥åŠ›ã—ã€ã€Œèª­ã¿è¾¼ã‚€ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ **Enter** ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚<br>
            ã“ã®ãƒ—ãƒ­ã‚­ã‚·ã‚’çµŒç”±ã—ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        </div>
        
        <iframe id="proxy-iframe" sandbox="allow-same-origin allow-scripts" title="Proxied Content"></iframe>
    </div>

    <script>
        const backButton = document.getElementById('back-button');

        const loadProxiedUrl = async () => {
            const targetUrl = document.getElementById('url-input').value.trim();
            const contentContainer = document.getElementById('content-container');
            const initialMessage = document.getElementById('initial-message');

            if (!targetUrl || !targetUrl.startsWith('http')) {
                alert('æœ‰åŠ¹ãªURLï¼ˆhttpã¾ãŸã¯httpsã§å§‹ã¾ã‚‹ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            if (initialMessage) {
                initialMessage.classList.add('hidden');
            }
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            contentContainer.innerHTML = `
                <div class="message-overlay">
                    <p class="loading-message">
                        <span class="spinner"></span> å¤–éƒ¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å–å¾—ä¸­...
                    </p>
                </div>
            `;
            
            // æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’ä¸€æ—¦éè¡¨ç¤º (èª­ã¿è¾¼ã¿ä¸­ã¯æ“ä½œã•ã›ãªã„)
            backButton.style.display = 'none'; 

            const proxyEndpoint = `/proxy?url=${encodeURIComponent(targetUrl)}`; 

            try {
                const response = await fetch(proxyEndpoint);
                
                if (!response.ok) {
                    let errorDetails = 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼';
                    try {
                        const errorJson = await response.json();
                        errorDetails = errorJson.error || errorDetails;
                    } catch (e) {
                        errorDetails = await response.text();
                        if (errorDetails.length > 200) errorDetails = errorDetails.substring(0, 200) + '...';
                    }
                    throw new Error(`ãƒ—ãƒ­ã‚­ã‚·é€šä¿¡å¤±æ•— (${response.status}): ${errorDetails}`);
                }

                const htmlContent = await response.text();
                
                // æ–°ã—ã„iframeã‚’ä½œæˆã—ã¦è¡¨ç¤º
                contentContainer.innerHTML = `
                    <iframe id="proxy-iframe" sandbox="allow-same-origin allow-scripts" title="Proxied Content"></iframe>
                `;
                const newIframe = document.getElementById('proxy-iframe');
                newIframe.style.display = 'block';

                const doc = newIframe.contentDocument || newIframe.contentWindow.document;
                
                doc.open();
                doc.write(htmlContent);
                doc.close();
                
                // æˆåŠŸæ™‚ã€æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                backButton.style.display = 'inline-block';

            } catch (error) {
                console.error('Fetch error:', error);
                // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                contentContainer.innerHTML = `
                    <div class="message-overlay" style="background-color: #fef2f2; color: #dc2626; border: 1px solid #fca5a5; padding: 20px; border-radius: 8px;">
                        <p style="font-weight: 700; font-size: 1.3rem;">
                            ğŸ›‘ ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ©ãƒ¼
                        </p>
                        <p>è©³ç´°: ${error.message}</p>
                    </div>
                `;
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
                backButton.style.display = 'none';
            }
        };
        
        // 1. ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å®Ÿè¡Œ
        document.getElementById('load-button').addEventListener('click', loadProxiedUrl);
        
        // 2. Enterã‚­ãƒ¼ã§å®Ÿè¡Œ
        document.getElementById('url-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                loadProxiedUrl();
            }
        });
        
        // 3. æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®æ©Ÿèƒ½
        backButton.addEventListener('click', () => {
            // ãƒ–ãƒ©ã‚¦ã‚¶ã®å±¥æ­´ã‚’1ã¤æˆ»ã‚‹
            history.back(); 
        });
    </script>
</body>
</html>
